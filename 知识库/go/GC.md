#### 简介

三色标记清除算核心原则就是根据每个对象的颜色，分到不同的颜色集合中，对象的颜色是在标记阶段完成的。三色是黑白灰三种颜色，每种颜色的集合都有特别的含义：

- 黑色集合
    
    该集合下的对象没有引用任何白色对象（即该对象没有指针指向白色对象）
    
- 白色集合
    
    扫描标记结束之后，白色集合里面的对象就是要进行垃圾回收的，该对象允许有指针指向黑色对象。
    
- 灰色集合
    
    可能有指针指向白色对象。它是一个中间状态，只有该集合下不在存在任何对象时候，才能进行最终的清除操作。

#### 过程

1. 标记准备，开启写屏障
    
2. 标记开始，与赋值器(黑色)并发执行，写屏障并发执行
    
3. 标记结束，归还内存到堆，停止写屏障
    

gc触发时机：

- 主动触发：runtime.GC
    
- 被动触发：
    
    - 使用系统监控，runtime.forcegcperiod变量控制，默认两分钟
        
    - 步调算法（Pacing）:控制内存增长比例

